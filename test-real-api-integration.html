<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸå®APIé›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        .input-group {
            margin: 15px 0;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background: #f0f8ff;
            border: 1px solid #b0d4ff;
            border-radius: 5px;
            min-height: 100px;
        }
        .success {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .error {
            background: #ffebee;
            border-color: #f44336;
        }
        .info {
            background: #fff3e0;
            border-color: #ff9800;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .model-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        .model-available {
            background: #4caf50;
            color: white;
        }
        .model-limited {
            background: #ff9800;
            color: white;
        }
        .model-unavailable {
            background: #f44336;
            color: white;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            flex: 1;
            margin: 0 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007AFF;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ çœŸå®APIé›†æˆæµ‹è¯•</h1>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalRequests">0</div>
                <div class="stat-label">æ€»è¯·æ±‚æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successCount">0</div>
                <div class="stat-label">æˆåŠŸæ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgTime">0ms</div>
                <div class="stat-label">å¹³å‡å“åº”æ—¶é—´</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ æµ‹è¯•é…ç½®</h2>
            
            <div class="input-group">
                <label for="testText">æµ‹è¯•æ–‡æœ¬ï¼š</label>
                <textarea id="testText" rows="4">æŠ•èµ„æœ‰é£é™©ï¼Œè¯·è°¨æ…å†³ç­–ã€‚åœ¨è¿›è¡Œä»»ä½•æŠ•èµ„å‰ï¼Œè¯·å……åˆ†äº†è§£ç›¸å…³äº§å“çš„ç‰¹æ€§å’Œé£é™©ã€‚</textarea>
            </div>
            
            <div class="input-group">
                <label for="siteType">åœºæ™¯ç±»å‹ï¼š</label>
                <select id="siteType">
                    <option value="general">é€šç”¨</option>
                    <option value="longport">LongPorté‡‘è</option>
                    <option value="notion">Notionæ–‡æ¡£</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="modelSelect">é€‰æ‹©æ¨¡å‹ï¼š</label>
                <select id="modelSelect">
                    <option value="auto">è‡ªåŠ¨é€‰æ‹©</option>
                    <option value="gpt-4o-mini">GPT-4o Mini (æ¨è)</option>
                    <option value="gpt-4o">GPT-4o</option>
                    <option value="gpt-5-chat">GPT-5 Chat</option>
                    <option value="DeepSeek-R1">DeepSeek-R1</option>
                    <option value="o3-mini">O3 Mini</option>
                    <option value="o3">O3</option>
                </select>
            </div>
            
            <button id="testRealAPI" onclick="testRealAPI()">æµ‹è¯•çœŸå®API</button>
            <button id="testMockAPI" onclick="testMockAPI()">æµ‹è¯•æ¨¡æ‹ŸAPI</button>
            <button id="compareAPIs" onclick="compareAPIs()">å¯¹æ¯”æµ‹è¯•</button>
            <button id="testAllModels" onclick="testAllModels()">æµ‹è¯•æ‰€æœ‰æ¨¡å‹</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        // ç»Ÿè®¡æ•°æ®
        let stats = {
            totalRequests: 0,
            successCount: 0,
            totalTime: 0
        };
        
        function updateStats() {
            document.getElementById('totalRequests').textContent = stats.totalRequests;
            document.getElementById('successCount').textContent = stats.successCount;
            const avgTime = stats.totalRequests > 0 ? Math.round(stats.totalTime / stats.totalRequests) : 0;
            document.getElementById('avgTime').textContent = avgTime + 'ms';
        }
        
        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultBox = document.createElement('div');
            resultBox.className = `result-box ${type}`;
            
            const titleEl = document.createElement('h3');
            titleEl.textContent = title;
            resultBox.appendChild(titleEl);
            
            const contentEl = document.createElement('pre');
            contentEl.textContent = content;
            resultBox.appendChild(contentEl);
            
            resultsDiv.insertBefore(resultBox, resultsDiv.firstChild);
        }
        
        function showLoading(message) {
            const resultsDiv = document.getElementById('results');
            const loadingBox = document.createElement('div');
            loadingBox.className = 'result-box info';
            loadingBox.id = 'loadingBox';
            loadingBox.innerHTML = `${message}<span class="loading"></span>`;
            resultsDiv.insertBefore(loadingBox, resultsDiv.firstChild);
        }
        
        function hideLoading() {
            const loadingBox = document.getElementById('loadingBox');
            if (loadingBox) {
                loadingBox.remove();
            }
        }
        
        async function callAPI(text, siteType, useRealAPI = true) {
            const startTime = Date.now();
            stats.totalRequests++;
            
            try {
                const result = await chrome.runtime.sendMessage({
                    action: 'callAI',
                    text: text,
                    apiType: useRealAPI ? 'company' : 'mock',
                    siteType: siteType
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                stats.totalTime += responseTime;
                
                if (result && typeof result === 'string' && result.trim().length > 0) {
                    stats.successCount++;
                    updateStats();
                    return {
                        success: true,
                        result: result,
                        responseTime: responseTime
                    };
                } else {
                    updateStats();
                    return {
                        success: false,
                        error: 'è¿”å›ç»“æœä¸ºç©ºæˆ–æ— æ•ˆ',
                        responseTime: responseTime
                    };
                }
            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                stats.totalTime += responseTime;
                updateStats();
                
                return {
                    success: false,
                    error: error.message,
                    responseTime: responseTime
                };
            }
        }
        
        async function testRealAPI() {
            const text = document.getElementById('testText').value;
            const siteType = document.getElementById('siteType').value;
            
            showLoading('æ­£åœ¨è°ƒç”¨çœŸå®API...');
            disableButtons(true);
            
            const result = await callAPI(text, siteType, true);
            
            hideLoading();
            disableButtons(false);
            
            if (result.success) {
                addResult(
                    `âœ… çœŸå®APIè°ƒç”¨æˆåŠŸ (${result.responseTime}ms)`,
                    `åŸæ–‡ï¼š${text}\n\nä¼˜åŒ–åï¼š${result.result}`,
                    'success'
                );
            } else {
                addResult(
                    `âŒ çœŸå®APIè°ƒç”¨å¤±è´¥ (${result.responseTime}ms)`,
                    `é”™è¯¯ï¼š${result.error}`,
                    'error'
                );
            }
        }
        
        async function testMockAPI() {
            const text = document.getElementById('testText').value;
            const siteType = document.getElementById('siteType').value;
            
            showLoading('æ­£åœ¨è°ƒç”¨æ¨¡æ‹ŸAPI...');
            disableButtons(true);
            
            const result = await callAPI(text, siteType, false);
            
            hideLoading();
            disableButtons(false);
            
            if (result.success) {
                addResult(
                    `âœ… æ¨¡æ‹ŸAPIè°ƒç”¨æˆåŠŸ (${result.responseTime}ms)`,
                    `åŸæ–‡ï¼š${text}\n\nä¼˜åŒ–åï¼š${result.result}`,
                    'success'
                );
            } else {
                addResult(
                    `âŒ æ¨¡æ‹ŸAPIè°ƒç”¨å¤±è´¥ (${result.responseTime}ms)`,
                    `é”™è¯¯ï¼š${result.error}`,
                    'error'
                );
            }
        }
        
        async function compareAPIs() {
            const text = document.getElementById('testText').value;
            const siteType = document.getElementById('siteType').value;
            
            showLoading('æ­£åœ¨è¿›è¡Œå¯¹æ¯”æµ‹è¯•...');
            disableButtons(true);
            
            // åŒæ—¶æµ‹è¯•ä¸¤ä¸ªAPI
            const [realResult, mockResult] = await Promise.all([
                callAPI(text, siteType, true),
                callAPI(text, siteType, false)
            ]);
            
            hideLoading();
            disableButtons(false);
            
            let comparison = `åŸæ–‡ï¼š${text}\n\n`;
            comparison += '='.repeat(50) + '\n\n';
            
            comparison += `çœŸå®API (${realResult.responseTime}ms):\n`;
            if (realResult.success) {
                comparison += `âœ… æˆåŠŸ\n${realResult.result}\n\n`;
            } else {
                comparison += `âŒ å¤±è´¥: ${realResult.error}\n\n`;
            }
            
            comparison += '='.repeat(50) + '\n\n';
            
            comparison += `æ¨¡æ‹ŸAPI (${mockResult.responseTime}ms):\n`;
            if (mockResult.success) {
                comparison += `âœ… æˆåŠŸ\n${mockResult.result}`;
            } else {
                comparison += `âŒ å¤±è´¥: ${mockResult.error}`;
            }
            
            const type = realResult.success && mockResult.success ? 'success' : 
                        realResult.success || mockResult.success ? 'info' : 'error';
            
            addResult('ğŸ“Š APIå¯¹æ¯”æµ‹è¯•ç»“æœ', comparison, type);
        }
        
        async function testAllModels() {
            const text = document.getElementById('testText').value;
            const models = ['gpt-4o-mini', 'gpt-4o', 'gpt-5-chat', 'DeepSeek-R1', 'o3-mini', 'o3'];
            
            showLoading('æ­£åœ¨æµ‹è¯•æ‰€æœ‰æ¨¡å‹...');
            disableButtons(true);
            
            let results = 'æ¨¡å‹æµ‹è¯•ç»“æœ:\n\n';
            
            for (const model of models) {
                // è¿™é‡Œéœ€è¦æ‰©å±•background.jsä»¥æ”¯æŒæŒ‡å®šæ¨¡å‹
                results += `${model}: æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...\n`;
            }
            
            hideLoading();
            disableButtons(false);
            
            addResult('ğŸ§ª æ‰€æœ‰æ¨¡å‹æµ‹è¯•', results, 'info');
        }
        
        function disableButtons(disabled) {
            document.getElementById('testRealAPI').disabled = disabled;
            document.getElementById('testMockAPI').disabled = disabled;
            document.getElementById('compareAPIs').disabled = disabled;
            document.getElementById('testAllModels').disabled = disabled;
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            addResult('ğŸ’¡ æµ‹è¯•è¯´æ˜', 
                '1. çœŸå®APIå·²é…ç½®å¯ç”¨æ¨¡å‹ï¼šgpt-4o-mini, gpt-4o, gpt-5-chatç­‰\n' +
                '2. å¦‚é‡åˆ°429é”™è¯¯ï¼ˆé€Ÿç‡é™åˆ¶ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨æ¨¡å‹\n' +
                '3. æ¨¡æ‹ŸAPIæä¾›åŸºç¡€ä¼˜åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æœåŠ¡å§‹ç»ˆå¯ç”¨\n' +
                '4. ä½¿ç”¨å¯¹æ¯”æµ‹è¯•å¯ä»¥æŸ¥çœ‹ä¸¤ç§APIçš„æ•ˆæœå·®å¼‚',
                'info'
            );
        });
    </script>
</body>
</html>
