# API测试指南

本文档提供了验证LongPort AI助手API调用的详细步骤和方法。

## 本地验证方法

### 1. 准备工作

1. **安装Chrome浏览器**：确保已安装最新版本的Chrome浏览器。
2. **构建项目**：在项目根目录执行以下命令构建项目：
   ```bash
   npm install
   npm run build
   ```

### 2. 加载Chrome扩展

1. 打开Chrome浏览器
2. 在地址栏输入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目中的 `dist` 目录
6. 确认扩展已成功加载（应该能看到"LongPort AI Pro"扩展）

### 3. 配置API设置

1. 点击Chrome工具栏中的扩展图标
2. 点击"LongPort AI Pro"扩展
3. 点击"选项"或"设置"按钮
4. 在设置页面中填写：
   - **API地址**：输入有效的API端点URL
   - **API密钥**：输入有效的API密钥
5. 点击"保存设置"按钮

### 4. 测试API连接

1. 在设置页面中，点击"测试API连接"按钮
2. 观察测试结果：
   - 如果显示"连接成功"，表示API配置正确
   - 如果显示错误，请检查API地址和密钥是否正确

### 5. 测试文案优化功能

1. 在设置页面中，点击"文案优化测试"按钮
2. 在测试页面中：
   - 输入一段测试文本（例如："这是一个测试文本，用于验证API调用是否成功。"）
   - 选择优化模式（基础模式或严格模式）
   - 点击"执行优化"按钮
3. 观察优化结果：
   - 如果显示优化后的文本，表示API调用成功
   - 如果显示错误，请检查浏览器控制台获取详细错误信息

## 故障排除

### 1. 使用浏览器开发者工具

1. 在Chrome中打开开发者工具（按F12或右键点击页面并选择"检查"）
2. 切换到"网络"(Network)标签页
3. 执行文案优化操作
4. 查找对API端点的POST请求
5. 检查请求和响应内容：
   - 请求格式是否正确
   - 响应状态码是否为200
   - 响应内容是否为有效的JSON

### 2. 常见问题及解决方法

#### API连接测试失败

- **问题**：服务器响应成功(200)，但返回的不是有效的JSON数据
- **解决方法**：
  1. 检查API端点是否正确
  2. 确认API密钥格式是否正确（是否需要包含"Bearer "前缀）
  3. 检查API服务是否支持简化的请求格式（只包含text字段）

#### 文案优化返回原文

- **问题**：API调用后返回的文本与输入文本相同
- **解决方法**：
  1. 检查浏览器控制台中的请求和响应
  2. 确认API服务是否正确处理了请求
  3. 尝试使用更明显需要优化的文本（例如包含语法错误或标点问题的文本）

#### API请求次数未增加

- **问题**：API服务显示请求次数没有变化
- **解决方法**：
  1. 确认API端点是否正确（是否指向了测试环境而非生产环境）
  2. 检查请求是否被CORS策略阻止（查看控制台错误信息）
  3. 检查API密钥是否有效且具有足够的权限

## 验证API调用成功的标准

1. **设置中测试API连接通过**：显示"连接成功"
2. **文案优化测试返回优化文字**：输入文本和输出文本不同，且优化后的文本符合产品文档中的要求
3. **API服务记录到请求**：在API提供方的控制台或日志中能看到请求记录增加

## 手动API测试（使用curl）

如果需要排除Chrome扩展的问题，可以使用curl直接测试API：

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{"text":"这是一个测试文本，用于验证API调用是否成功。"}' \
  YOUR_API_ENDPOINT
```

替换`YOUR_API_KEY`和`YOUR_API_ENDPOINT`为实际的API密钥和端点。

## 注意事项

1. 确保API端点支持CORS，否则浏览器将阻止请求
2. 某些API服务可能需要特定的请求格式，请参考API文档
3. 如果API服务需要额外的认证头或参数，请相应修改代码
