<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>模拟API优化函数修复测试</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .test-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-panel h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .result-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .result-item .label {
            font-weight: bold;
            min-width: 120px;
            margin-right: 20px;
            color: #333;
        }
        
        .result-item .content {
            flex: 1;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        .comparison {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .comparison h3 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .difference {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
        }
        
        .difference h4 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔧 模拟API优化函数修复测试</h1>
        <p>测试修复后的模拟API优化函数是否产生有效的优化效果</p>
    </div>
    
    <div class="test-panel">
        <h2>🧪 测试配置</h2>
        
        <div class="input-group">
            <label for="testText">测试文本：</label>
            <textarea id="testText" rows="4" placeholder="请输入需要优化的文本内容...">这是一个关于投资理财的文案，我们需要优化它的表达方式，使其更加专业和清晰。投资有风险，收益不确定，请谨慎决策。</textarea>
        </div>
        
        <div class="input-group">
            <label for="siteType">网站类型：</label>
            <select id="siteType">
                <option value="longport">LongPort (金融专业)</option>
                <option value="notion">Notion (文档协作)</option>
                <option value="general">通用</option>
            </select>
        </div>
        
        <button class="btn" onclick="runOptimizationTest()">
            🚀 运行优化测试
        </button>
    </div>
    
    <div id="resultSection" class="test-panel" style="display: none;">
        <h2>📊 测试结果</h2>
        
        <div class="result-section">
            <div class="result-item">
                <div class="label">原始文本：</div>
                <div class="content" id="originalText"></div>
            </div>
            
            <div class="result-item">
                <div class="label">优化后文本：</div>
                <div class="content" id="optimizedText"></div>
            </div>
            
            <div class="result-item">
                <div class="label">网站类型：</div>
                <div class="content" id="resultSiteType"></div>
            </div>
        </div>
        
        <div class="comparison">
            <h3>📈 优化效果分析</h3>
            <div id="optimizationAnalysis"></div>
        </div>
        
        <div class="difference">
            <h4>🔍 主要改进点</h4>
            <div id="improvementPoints"></div>
        </div>
    </div>
    
    <script>
        // 模拟API优化函数（从background.js复制）
        
        // LongPort 特定优化
        function performLongPortOptimization(text) {
          // 金融内容的专业优化
          let optimized = text;
          
          // 优化标点符号和格式
          optimized = optimized.replace(/，/g, '， ').replace(/。/g, '。 ');
          optimized = optimized.replace(/：/g, '： ').replace(/；/g, '； ');
          
          // 优化金融术语表达
          optimized = optimized.replace(/投资/g, '投资理财').replace(/收益/g, '投资回报');
          optimized = optimized.replace(/风险/g, '投资风险').replace(/市场/g, '金融市场');
          
          // 优化句式结构
          if (optimized.length > 50) {
            optimized = optimized.replace(/。/g, '。\n');
          }
          
          // 添加金融专业性
          if (!optimized.includes('专业') && !optimized.includes('权威')) {
            optimized = optimized.replace(/。/g, '。\n');
            optimized += '\n\n注：以上内容基于专业金融分析，仅供参考。';
          }
          
          return optimized;
        }
        
        // Notion 特定优化
        function performNotionOptimization(text) {
          // 文档内容的逻辑优化
          let optimized = text;
          
          // 优化标点符号和格式
          optimized = optimized.replace(/，/g, '， ').replace(/。/g, '。 ');
          optimized = optimized.replace(/：/g, '： ').replace(/；/g, '； ');
          
          // 优化文档结构
          if (optimized.includes('首先') || optimized.includes('其次')) {
            optimized = optimized.replace(/。/g, '。\n');
          }
          
          // 添加逻辑连接词
          optimized = optimized.replace(/。/g, '。\n');
          
          // 添加文档专业性
          if (!optimized.includes('建议') && !optimized.includes('总结')) {
            optimized += '\n\n建议：请根据实际情况调整和完善以上内容。';
          }
          
          return optimized;
        }
        
        // 通用优化
        function performGeneralOptimization(text) {
          // 通用文本优化
          let optimized = text;
          
          // 优化标点符号和格式
          optimized = optimized.replace(/，/g, '， ').replace(/。/g, '。 ');
          optimized = optimized.replace(/：/g, '： ').replace(/；/g, '； ');
          
          // 优化空格
          optimized = optimized.replace(/\s+/g, ' ').trim();
          
          // 添加通用改进
          if (optimized.length > 20) {
            optimized = optimized.replace(/。/g, '。\n');
          }
          
          // 添加优化说明
          if (!optimized.includes('优化') && !optimized.includes('改进')) {
            optimized += '\n\n注：以上内容已进行语言优化，提升了表达清晰度。';
          }
          
          return optimized;
        }
        
        // 运行优化测试
        function runOptimizationTest() {
          const testText = document.getElementById('testText').value.trim();
          const siteType = document.getElementById('siteType').value;
          
          if (!testText) {
            alert('请输入测试文本');
            return;
          }
          
          console.log('开始优化测试...');
          console.log('原始文本:', testText);
          console.log('网站类型:', siteType);
          
          let optimizedText;
          
          // 根据网站类型选择优化函数
          switch (siteType) {
            case 'longport':
              optimizedText = performLongPortOptimization(testText);
              break;
            case 'notion':
              optimizedText = performNotionOptimization(testText);
              break;
            case 'general':
            default:
              optimizedText = performGeneralOptimization(testText);
              break;
          }
          
          console.log('优化后文本:', optimizedText);
          
          // 显示结果
          displayResults(testText, optimizedText, siteType);
        }
        
        // 显示测试结果
        function displayResults(originalText, optimizedText, siteType) {
          // 显示结果区域
          document.getElementById('resultSection').style.display = 'block';
          
          // 填充结果
          document.getElementById('originalText').textContent = originalText;
          document.getElementById('optimizedText').textContent = optimizedText;
          document.getElementById('resultSiteType').textContent = getSiteTypeName(siteType);
          
          // 分析优化效果
          analyzeOptimization(originalText, optimizedText, siteType);
        }
        
        // 获取网站类型名称
        function getSiteTypeName(siteType) {
          const names = {
            'longport': 'LongPort (金融专业)',
            'notion': 'Notion (文档协作)',
            'general': '通用'
          };
          return names[siteType] || siteType;
        }
        
        // 分析优化效果
        function analyzeOptimization(originalText, optimizedText, siteType) {
          const originalLength = originalText.length;
          const optimizedLength = optimizedText.length;
          const lengthRatio = optimizedLength / originalLength;
          
          let analysis = `文本长度变化：原文 ${originalLength} 字符 → 优化后 ${optimizedText.length} 字符\n`;
          analysis += `长度比例：${(lengthRatio * 100).toFixed(1)}%\n\n`;
          
          if (lengthRatio > 1.1) {
            analysis += '✅ 文本内容得到丰富，增加了专业性和可读性\n';
          } else if (lengthRatio < 0.9) {
            analysis += '⚠️ 文本内容有所精简，保持了核心信息\n';
          } else {
            analysis += '✅ 文本长度适中，优化效果平衡\n';
          }
          
          // 检查特定改进
          const improvements = [];
          
          if (optimizedText.includes('注：')) {
            improvements.push('添加了专业性说明');
          }
          
          if (optimizedText.includes('建议：')) {
            improvements.push('添加了实用建议');
          }
          
          if (optimizedText.includes('投资理财') || optimizedText.includes('投资回报')) {
            improvements.push('优化了金融术语表达');
          }
          
          if (optimizedText.includes('\n')) {
            improvements.push('改进了文本结构和格式');
          }
          
          if (improvements.length > 0) {
            analysis += `\n主要改进：${improvements.join('、')}`;
          }
          
          document.getElementById('optimizationAnalysis').textContent = analysis;
          
          // 显示改进点
          const improvementPoints = [];
          
          if (siteType === 'longport') {
            improvementPoints.push('金融术语专业化');
            improvementPoints.push('标点符号格式优化');
            improvementPoints.push('添加专业分析说明');
          } else if (siteType === 'notion') {
            improvementPoints.push('文档结构优化');
            improvementPoints.push('逻辑连接词改进');
            improvementPoints.push('添加实用建议');
          } else {
            improvementPoints.push('语言表达优化');
            improvementPoints.push('格式结构改进');
            improvementPoints.push('清晰度提升');
          }
          
          document.getElementById('improvementPoints').textContent = improvementPoints.join('\n• ');
        }
        
        console.log('模拟API优化函数修复测试页面已加载');
    </script>
</body>
</html>
