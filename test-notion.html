<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notion 页面模拟 - 测试 AI 助手</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      line-height: 1.6;
      background: #fafafa;
    }
    
    .notion-page {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .notion-title {
      font-size: 32px;
      font-weight: 700;
      color: #37352f;
      margin-bottom: 30px;
      border-bottom: 2px solid #e8e8e8;
      padding-bottom: 20px;
    }
    
    .notion-content {
      font-size: 16px;
      color: #37352f;
      line-height: 1.7;
    }
    
    .notion-paragraph {
      margin-bottom: 20px;
      padding: 8px 0;
      cursor: text;
      user-select: text;
    }
    
    .notion-paragraph:hover {
      background: #f7f7f7;
      border-radius: 4px;
    }
    
    .test-instructions {
      background: #f0f9ff;
      border: 1px solid #0ea5e9;
      border-radius: 8px;
      padding: 20px;
      margin: 30px 0;
    }
    
    .test-instructions h3 {
      color: #0369a1;
      margin-top: 0;
    }
    
    .test-instructions ol {
      margin: 0;
      padding-left: 20px;
    }
    
    .test-instructions li {
      margin-bottom: 8px;
    }
    
    .debug-info {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .debug-info h3 {
      color: #92400e;
      margin-top: 0;
    }
    
    .status-indicator {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      margin-left: 10px;
    }
    
    .status-success {
      background: #dcfce7;
      color: #166534;
    }
    
    .status-error {
      background: #fecaca;
      color: #dc2626;
    }
    
    .status-pending {
      background: #dbeafe;
      color: #1e40af;
    }
  </style>
</head>
<body>
  <div class="notion-page">
    <h1 class="notion-title">AI 助手功能测试页面</h1>
    
    <div class="test-instructions">
      <h3>测试步骤</h3>
      <ol>
        <li>确保 Notion AI 助手插件已安装并启用</li>
        <li>选择下面的任意文本段落</li>
        <li>右键点击，应该看到"AI 辅助协作"选项</li>
        <li>点击后应该出现 AI 弹窗</li>
        <li>弹窗应显示原文和 AI 优化结果</li>
        <li>测试三个按钮：覆盖原文、再试一下、取消</li>
      </ol>
    </div>
    
    <div class="debug-info">
      <h3>调试信息</h3>
      <p>插件状态: <span id="pluginStatus" class="status-indicator status-pending">检查中...</span></p>
      <p>内容脚本: <span id="contentScriptStatus" class="status-indicator status-pending">检查中...</span></p>
      <p>右键菜单: <span id="contextMenuStatus" class="status-indicator status-pending">检查中...</span></p>
      <button onclick="checkStatus()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
        刷新状态
      </button>
    </div>
    
    <div class="notion-content">
      <div class="notion-paragraph">
        这是一个测试段落，用于验证 Notion AI 助手插件的功能。这段文字包含一些可以优化的地方，比如表达可以更加清晰，用词可以更加准确。请选择这段文字，然后右键点击查看是否出现"AI 辅助协作"选项。
      </div>
      
      <div class="notion-paragraph">
        第二个测试段落包含一些语法问题，比如句子结构比较复杂，可以简化一下。同时，某些词汇的使用也可以更加精准，让整个表达更加流畅自然。AI 助手应该能够识别这些问题并提供改进建议。
      </div>
      
      <div class="notion-paragraph">
        英文测试段落：This is a test paragraph for the Notion AI Assistant plugin. This text contains some areas that could be improved, such as making the expression clearer and using more precise vocabulary. Please select this text and right-click to see if the "AI 辅助协作" option appears.
      </div>
      
      <div class="notion-paragraph">
        最后一个测试段落，这里我们测试一些更复杂的表达。比如，我们可以使用一些比较长的句子来测试 AI 助手的分析能力，看看它是否能够识别出句子过长、结构复杂等问题，并提供相应的优化建议。
      </div>
    </div>
  </div>

  <script>
    // 检查插件状态
    function checkStatus() {
      const pluginStatus = document.getElementById('pluginStatus');
      const contentScriptStatus = document.getElementById('contentScriptStatus');
      const contextMenuStatus = document.getElementById('contextMenuStatus');
      
      // 检查插件是否安装
      if (typeof chrome !== 'undefined' && chrome.runtime) {
        pluginStatus.textContent = '已安装';
        pluginStatus.className = 'status-indicator status-success';
        
        // 检查内容脚本
        if (window.notionAIHelperLoaded) {
          contentScriptStatus.textContent = '已加载';
          contentScriptStatus.className = 'status-indicator status-success';
        } else {
          contentScriptStatus.textContent = '未加载';
          contentScriptStatus.className = 'status-indicator status-error';
        }
        
        // 测试右键菜单功能
        testContextMenu();
      } else {
        pluginStatus.textContent = '未安装';
        pluginStatus.className = 'status-indicator status-error';
        contentScriptStatus.textContent = '无法检查';
        contentScriptStatus.className = 'status-indicator status-error';
        contextMenuStatus.textContent = '无法检查';
        contextMenuStatus.className = 'status-indicator status-error';
      }
    }
    
    // 测试右键菜单功能
    function testContextMenu() {
      const contextMenuStatus = document.getElementById('contextMenuStatus');
      
      // 模拟选择文本
      const testText = document.querySelector('.notion-paragraph');
      const selection = window.getSelection();
      const range = document.createRange();
      range.selectNodeContents(testText);
      selection.removeAllRanges();
      selection.addRange(range);
      
      // 尝试发送消息到插件
      try {
        chrome.runtime.sendMessage({
          action: 'ping'
        }, (response) => {
          if (chrome.runtime.lastError) {
            contextMenuStatus.textContent = '连接失败';
            contextMenuStatus.className = 'status-indicator status-error';
          } else {
            contextMenuStatus.textContent = '连接正常';
            contextMenuStatus.className = 'status-indicator status-success';
          }
        });
      } catch (error) {
        contextMenuStatus.textContent = '测试失败';
        contextMenuStatus.className = 'status-indicator status-error';
      }
    }
    
    // 页面加载时自动检查
    window.addEventListener('load', checkStatus);
    
    // 监听来自插件的内容脚本消息
    window.addEventListener('message', (event) => {
      if (event.source === window && event.data.type === 'NOTION_AI_HELPER_LOADED') {
        window.notionAIHelperLoaded = true;
        checkStatus();
      }
    });
    
    // 添加选择文本的视觉反馈
    document.querySelectorAll('.notion-paragraph').forEach(paragraph => {
      paragraph.addEventListener('mouseup', () => {
        const selection = window.getSelection();
        if (selection.toString().length > 0) {
          paragraph.style.background = '#e0f2fe';
          setTimeout(() => {
            paragraph.style.background = 'transparent';
          }, 1000);
        }
      });
    });
  </script>
</body>
</html>
