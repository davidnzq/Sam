<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options AIæµ‹è¯•æ¨¡å—ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-container h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .result-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .result-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .result-item .label {
            font-weight: bold;
            min-width: 120px;
            margin-right: 20px;
            color: #333;
        }
        
        .result-item .content {
            flex: 1;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        .test-status {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            text-align: center;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-text h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .status-text p {
            margin: 0;
            color: #666;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e1e5e9;
        }
        
        .metric-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-card .label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .error-section {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            display: none;
        }
        
        .error-section h4 {
            margin-top: 0;
            color: #dc2626;
        }
        
        .success-section {
            background: #f0fdf4;
            border-left: 4px solid #16a34a;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            display: none;
        }
        
        .success-section h4 {
            margin-top: 0;
            color: #16a34a;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”§ Options AIæµ‹è¯•æ¨¡å—ä¿®å¤éªŒè¯</h1>
        <p>éªŒè¯AIæ–‡æ¡ˆä¼˜åŒ–æµ‹è¯•æ¨¡å—çš„ä¿®å¤æ•ˆæœ</p>
    </div>
    
    <div class="test-container">
        <h2>ğŸ§ª AIæ–‡æ¡ˆä¼˜åŒ–æµ‹è¯•</h2>
        
        <div class="form-group">
            <label for="testInputText">æµ‹è¯•æ–‡æ¡ˆï¼š</label>
            <textarea 
                id="testInputText" 
                placeholder="è¯·è¾“å…¥éœ€è¦ä¼˜åŒ–çš„æ–‡æ¡ˆå†…å®¹..."
                rows="6"
            >è¿™æ˜¯ä¸€ä¸ªå…³äºæŠ•èµ„ç†è´¢çš„æ–‡æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ä¼˜åŒ–å®ƒçš„è¡¨è¾¾æ–¹å¼ï¼Œä½¿å…¶æ›´åŠ ä¸“ä¸šå’Œæ¸…æ™°ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œæ”¶ç›Šä¸ç¡®å®šï¼Œè¯·è°¨æ…å†³ç­–ã€‚</textarea>
        </div>
        
        <div class="form-group">
            <label for="testSiteType">æµ‹è¯•åœºæ™¯ï¼š</label>
            <select id="testSiteType">
                <option value="longport">LongPort é‡‘èå¹³å°</option>
                <option value="notion">Notion æ–‡æ¡£åä½œ</option>
                <option value="general">é€šç”¨æ–‡æœ¬</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="testOptimizationType">ä¼˜åŒ–ç±»å‹ï¼š</label>
            <select id="testOptimizationType">
                <option value="deep_optimization">æ·±åº¦ä¼˜åŒ–</option>
                <option value="grammar_check">è¯­æ³•æ£€æŸ¥</option>
                <option value="style_improvement">é£æ ¼æ”¹è¿›</option>
            </select>
        </div>
        
        <button type="button" id="startTest" class="btn">
            ğŸš€ å¼€å§‹AIä¼˜åŒ–æµ‹è¯•
        </button>
        
        <button type="button" id="clearTest" class="btn btn-secondary">
            ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹
        </button>
        
        <button type="button" id="loadSampleText" class="btn btn-secondary">
            ğŸ“‹ åŠ è½½ç¤ºä¾‹æ–‡æ¡ˆ
        </button>
    </div>
    
    <!-- æµ‹è¯•çŠ¶æ€ -->
    <div id="testStatus" class="test-status">
        <div class="loading-spinner"></div>
        <div class="status-text">
            <h4>AI æ­£åœ¨ä¼˜åŒ–æ‚¨çš„æ–‡æ¡ˆ...</h4>
            <p id="statusMessage">è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´</p>
        </div>
    </div>
    
    <!-- æµ‹è¯•ç»“æœ -->
    <div id="resultSection" class="result-section">
        <h3>âœ¨ AIä¼˜åŒ–ç»“æœ</h3>
        
        <div class="result-item">
            <div class="label">åŸå§‹æ–‡æ¡ˆï¼š</div>
            <div class="content" id="originalText"></div>
        </div>
        
        <div class="result-item">
            <div class="label">AIä¼˜åŒ–åï¼š</div>
            <div class="content" id="optimizedText"></div>
        </div>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="value" id="lengthChange">0%</div>
                <div class="label">é•¿åº¦å˜åŒ–</div>
            </div>
            <div class="metric-card">
                <div class="value" id="processingTime">0ms</div>
                <div class="label">å¤„ç†æ—¶é—´</div>
            </div>
            <div class="metric-card">
                <div class="value" id="testStatus">-</div>
                <div class="label">æµ‹è¯•çŠ¶æ€</div>
            </div>
        </div>
    </div>
    
    <!-- æˆåŠŸæç¤º -->
    <div id="successSection" class="success-section">
        <h4>âœ… æµ‹è¯•æˆåŠŸï¼</h4>
        <p>AIæ–‡æ¡ˆä¼˜åŒ–æµ‹è¯•æ¨¡å—å·²ä¿®å¤ï¼Œèƒ½å¤Ÿæ­£ç¡®è¿”å›ä¼˜åŒ–ç»“æœã€‚</p>
    </div>
    
    <!-- é”™è¯¯æç¤º -->
    <div id="errorSection" class="error-section">
        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
        <p id="errorMessage">æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ã€‚</p>
    </div>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Options AIæµ‹è¯•æ¨¡å—ä¿®å¤éªŒè¯é¡µé¢åŠ è½½å®Œæˆ');
            bindEvents();
        });
        
        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            const startTestBtn = document.getElementById('startTest');
            const clearTestBtn = document.getElementById('clearTest');
            const loadSampleTextBtn = document.getElementById('loadSampleText');
            
            if (startTestBtn) {
                startTestBtn.addEventListener('click', startAITest);
                console.log('âœ… ç»‘å®šå¼€å§‹æµ‹è¯•æŒ‰é’®');
            }
            
            if (clearTestBtn) {
                clearTestBtn.addEventListener('click', clearTestContent);
                console.log('âœ… ç»‘å®šæ¸…ç©ºå†…å®¹æŒ‰é’®');
            }
            
            if (loadSampleTextBtn) {
                loadSampleTextBtn.addEventListener('click', loadSampleText);
                console.log('âœ… ç»‘å®šåŠ è½½ç¤ºä¾‹æ–‡æ¡ˆæŒ‰é’®');
            }
            
            console.log('äº‹ä»¶ç»‘å®šå®Œæˆ');
        }
        
        // å¼€å§‹AIæµ‹è¯•
        async function startAITest() {
            console.log('ğŸš€ å¼€å§‹AIæ–‡æ¡ˆä¼˜åŒ–æµ‹è¯•...');
            
            const inputText = document.getElementById('testInputText')?.value?.trim();
            const siteType = document.getElementById('testSiteType')?.value || 'general';
            const optimizationType = document.getElementById('testOptimizationType')?.value || 'deep_optimization';
            
            if (!inputText) {
                alert('è¯·è¾“å…¥éœ€è¦ä¼˜åŒ–çš„æ–‡æ¡ˆå†…å®¹');
                return;
            }
            
            if (inputText.length < 10) {
                alert('æ–‡æ¡ˆå†…å®¹å¤ªçŸ­ï¼Œå»ºè®®è¾“å…¥è‡³å°‘10ä¸ªå­—ç¬¦');
                return;
            }
            
            if (inputText.length > 1000) {
                alert('æ–‡æ¡ˆå†…å®¹å¤ªé•¿ï¼Œå»ºè®®ä¸è¶…è¿‡1000ä¸ªå­—ç¬¦');
                return;
            }
            
            // æ˜¾ç¤ºæµ‹è¯•çŠ¶æ€
            showTestStatus();
            
            // è®°å½•å¼€å§‹æ—¶é—´
            const startTime = Date.now();
            
            try {
                // è°ƒç”¨AIè¿›è¡Œä¼˜åŒ–
                const response = await chrome.runtime.sendMessage({
                    action: 'callAI',
                    text: inputText,
                    apiType: 'company',
                    siteType: siteType,
                    optimizationType: optimizationType
                });
                
                // è®¡ç®—å¤„ç†æ—¶é—´
                const processingTime = Date.now() - startTime;
                
                console.log('AIå“åº”:', response);
                
                if (response && response.success) {
                    // å®‰å…¨åœ°è·å–ä¼˜åŒ–åçš„æ–‡æœ¬ - æ”¯æŒå¤šç§å¯èƒ½çš„å­—æ®µå
                    let optimizedText = '';
                    
                    // æŒ‰ä¼˜å…ˆçº§å°è¯•ä¸åŒçš„å­—æ®µ
                    if (response.optimizedText && typeof response.optimizedText === 'string' && response.optimizedText.trim().length > 0) {
                        optimizedText = response.optimizedText;
                    } else if (response.result && typeof response.result === 'string' && response.result.trim().length > 0) {
                        optimizedText = response.result;
                    } else if (response.text && typeof response.text === 'string' && response.text.trim().length > 0) {
                        optimizedText = response.text;
                    } else if (response.optimized_text && typeof response.optimized_text === 'string' && response.optimized_text.trim().length > 0) {
                        optimizedText = response.optimized_text;
                    } else if (response.data && typeof response.data === 'string' && response.data.trim().length > 0) {
                        optimizedText = response.data;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–åˆ°ä¼˜åŒ–æ–‡æœ¬
                    if (optimizedText && optimizedText.trim().length > 0) {
                        // æ˜¾ç¤ºä¼˜åŒ–ç»“æœ
                        showTestResult(inputText, optimizedText, processingTime);
                        showSuccessSection();
                    } else {
                        // ä¼˜åŒ–ç»“æœä¸ºç©ºæˆ–æ— æ•ˆ
                        console.error('âŒ AIè¿”å›çš„ä¼˜åŒ–ç»“æœä¸ºç©ºæˆ–æ ¼å¼æ— æ•ˆ:', response);
                        showTestError(inputText, 'AIè¿”å›çš„ä¼˜åŒ–ç»“æœä¸ºç©ºæˆ–æ ¼å¼æ— æ•ˆï¼Œè¯·ä¿®å¤ï¼Œæ¯”ç”Ÿæ•ˆçº¿ä¸Šæ’ä»¶', processingTime);
                        showErrorSection('AIè¿”å›çš„ä¼˜åŒ–ç»“æœä¸ºç©ºæˆ–æ ¼å¼æ— æ•ˆ');
                    }
                } else {
                    // æ˜¾ç¤ºé”™è¯¯ç»“æœ
                    const errorMessage = response?.error || response?.message || 'AIä¼˜åŒ–å¤±è´¥';
                    showTestError(inputText, errorMessage, processingTime);
                    showErrorSection(errorMessage);
                }
                
            } catch (error) {
                console.error('âŒ AIæµ‹è¯•å¤±è´¥:', error);
                const processingTime = Date.now() - startTime;
                showTestError(inputText, `æµ‹è¯•å¤±è´¥: ${error.message}`, processingTime);
                showErrorSection(`æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ˜¾ç¤ºæµ‹è¯•çŠ¶æ€
        function showTestStatus() {
            const testStatus = document.getElementById('testStatus');
            const resultSection = document.getElementById('resultSection');
            const successSection = document.getElementById('successSection');
            const errorSection = document.getElementById('errorSection');
            
            if (testStatus) testStatus.style.display = 'block';
            if (resultSection) resultSection.style.display = 'none';
            if (successSection) successSection.style.display = 'none';
            if (errorSection) errorSection.style.display = 'none';
        }
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResult(originalText, optimizedText, processingTime) {
            console.log('âœ… æ˜¾ç¤ºæµ‹è¯•ç»“æœ:', { originalText, optimizedText, processingTime });
            
            // éšè—æµ‹è¯•çŠ¶æ€
            const testStatus = document.getElementById('testStatus');
            if (testStatus) testStatus.style.display = 'none';
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            const resultSection = document.getElementById('resultSection');
            if (resultSection) resultSection.style.display = 'block';
            
            // å¡«å……åŸå§‹æ–‡æ¡ˆ
            const originalTextEl = document.getElementById('originalText');
            if (originalTextEl) originalTextEl.textContent = originalText;
            
            // å¡«å……ä¼˜åŒ–åæ–‡æ¡ˆ
            const optimizedTextEl = document.getElementById('optimizedText');
            if (optimizedTextEl) optimizedTextEl.textContent = optimizedText;
            
            // æ›´æ–°æŒ‡æ ‡
            const lengthChange = ((optimizedText.length - originalText.length) / originalText.length * 100).toFixed(1);
            document.getElementById('lengthChange').textContent = lengthChange + '%';
            document.getElementById('processingTime').textContent = processingTime + 'ms';
            document.getElementById('testStatus').textContent = 'æˆåŠŸ';
        }
        
        // æ˜¾ç¤ºæµ‹è¯•é”™è¯¯
        function showTestError(originalText, errorMessage, processingTime) {
            console.log('âŒ æ˜¾ç¤ºæµ‹è¯•é”™è¯¯:', { originalText, errorMessage, processingTime });
            
            // éšè—æµ‹è¯•çŠ¶æ€
            const testStatus = document.getElementById('testStatus');
            if (testStatus) testStatus.style.display = 'none';
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            const resultSection = document.getElementById('resultSection');
            if (resultSection) resultSection.style.display = 'block';
            
            // å¡«å……åŸå§‹æ–‡æ¡ˆ
            const originalTextEl = document.getElementById('originalText');
            if (originalTextEl) originalTextEl.textContent = originalText || 'æ— åŸå§‹æ–‡æ¡ˆ';
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            const optimizedTextEl = document.getElementById('optimizedText');
            if (optimizedTextEl) optimizedTextEl.textContent = `âŒ ${errorMessage}`;
            
            // æ›´æ–°æŒ‡æ ‡
            document.getElementById('lengthChange').textContent = '0%';
            document.getElementById('processingTime').textContent = processingTime + 'ms';
            document.getElementById('testStatus').textContent = 'å¤±è´¥';
        }
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        function showSuccessSection() {
            const successSection = document.getElementById('successSection');
            if (successSection) successSection.style.display = 'block';
        }
        
        // æ˜¾ç¤ºé”™è¯¯æç¤º
        function showErrorSection(message) {
            const errorSection = document.getElementById('errorSection');
            const errorMessage = document.getElementById('errorMessage');
            if (errorSection) errorSection.style.display = 'block';
            if (errorMessage) errorMessage.textContent = message;
        }
        
        // æ¸…ç©ºæµ‹è¯•å†…å®¹
        function clearTestContent() {
            document.getElementById('testInputText').value = '';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('successSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';
            document.getElementById('testStatus').style.display = 'none';
        }
        
        // åŠ è½½ç¤ºä¾‹æ–‡æ¡ˆ
        function loadSampleText() {
            const sampleTexts = [
                'è¿™æ˜¯ä¸€ä¸ªå…³äºæŠ•èµ„ç†è´¢çš„æ–‡æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ä¼˜åŒ–å®ƒçš„è¡¨è¾¾æ–¹å¼ï¼Œä½¿å…¶æ›´åŠ ä¸“ä¸šå’Œæ¸…æ™°ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œæ”¶ç›Šä¸ç¡®å®šï¼Œè¯·è°¨æ…å†³ç­–ã€‚',
                'é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ†æå¸‚åœºæƒ…å†µï¼Œå…¶æ¬¡åˆ¶å®šæŠ•èµ„ç­–ç•¥ï¼Œæœ€åæ‰§è¡ŒæŠ•èµ„è®¡åˆ’ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦å›¢é˜Ÿåä½œï¼Œç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½å¾—åˆ°å¦¥å–„å¤„ç†ã€‚',
                'æˆ‘ä»¬çš„äº§å“å…·æœ‰é«˜è´¨é‡ã€ä½ä»·æ ¼ã€å¥½æœåŠ¡çš„ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿæ»¡è¶³å®¢æˆ·çš„å„ç§éœ€æ±‚ï¼Œæä¾›ä¼˜è´¨çš„è´­ç‰©ä½“éªŒã€‚'
            ];
            
            const randomIndex = Math.floor(Math.random() * sampleTexts.length);
            document.getElementById('testInputText').value = sampleTexts[randomIndex];
        }
        
        console.log('Options AIæµ‹è¯•æ¨¡å—ä¿®å¤éªŒè¯é¡µé¢è„šæœ¬å·²åŠ è½½');
    </script>
</body>
</html>
